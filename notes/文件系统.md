# 文件系统

## 概述

![alt text](assets/文件系统/image.png)

图为Linux内核的存储软件栈，以一个网络文件下载流程为例，当下载工具从网络中获取到文件内容之后，文件内容被暂存在下载工具的内存中。为了将这些数据持久保存下来，下载工具向操作系统发起一系列系统调用（如open和write等）。在处理系统调用时，Linux内核会调用其虚拟文件系统（Virtual File System VFS）处理文件请求。虚拟文件系统如同一个大管家负责管理具体的文件系统，并提供一系列服务，如页缓存（pagecache）、inode缓存（icache）和目录项缓存（dcache）等，Linux虚拟文件系统在解析用户的请求后，调用具体的文件系统的接口进一步处理请求。具体的文件系统（比如Ext4文件系统）会根据请求对数据进行读取或修改。当需要访问存储设备上的数据时，文件系统会创建对存储块的访问请求，并发送给I/O调度器。由于可能同时存在多个对存储设备的访问请求，I/O调度器根据预定策略对这些请求进行调度，以一定的顺序将请求发送给设备驱动。最终，设备驱动与存储设备进行交互并完成请求。在存储设备完成写入请求后，下载的文件便被持久保存到了存储设备之中。

